<!DOCTYPE html>
<html>
<head>

  <title>counter</title>

  <meta charset=utf-8>

  <script src=jquery.js></script>

  <link rel=stylesheet href="style.css" media=screen />

<script>
$(document).ready(function(){

  $('#crunch').click(calculate);

  function calculate(){

    $('.text').each(function(){

      var words = $.trim( $(this).html() ).split(/[\n ]+/) ;

      var worker = new Worker('counter.js');

      worker.postMessage( words );

      worker.addEventListener('message', function(e) {
        $.each(e.data, function(word, count){
          $('#counts tbody').prepend('<tr><td>'+count+'</td><td>'+word+' '+new Date().getMilliseconds()+ '</td></tr>');
        });
      }, false);

    })
  }

})
</script>

</head>

<body>

<header>
<button id=crunch>count words</button>

<output id="result"></output>

</header>

<div id=wrapper>
  <div id=alpha class=text>sheep hippo panda panda</div>
  <div id=beta class=text>hippo panda</div>
  <div id=gamma class=text>rhino rhino rhino panda</div>
  <table id=counts>
  <thead><tr><th>count</th><th>word</th></tr><thead>
  <tbody><tbody>
  </table>
</div><!-- #wrapper -->

</body>

</html>

